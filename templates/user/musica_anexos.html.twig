{% extends 'template-new.html.twig' %}

{% block title %}{% if musica.numero %}{{ musica.numero }} - {% endif %}{{ musica.nome }}{% endblock %}

{% block stylesheet %}
    {{ parent() }}
    <link href="{{ asset(app['dir.base'] ~ 'assets/plugins/jQuery-Chord-Transposer/jquery.transposer.css') }}" rel="stylesheet">
    <link href="{{ asset(app['dir.base'] ~ 'assets/plugins/jQuery.filer/css/jquery.filer.css') }}" type="text/css" rel="stylesheet"/>
{% endblock %}

{% block headerNome %}{% if musica.numero %}{{ musica.numero }} - {% endif %}{{ musica.nome }}{% endblock %}
{% block headerSubtitulo %}{{ musica.categoria.colecao.nome }} / {{ musica.categoria.nome }}{{ app['nome.blog'] }}{% endblock %}

{% block content %}

    <div id="comentarios"
         data-source="{{ path('api_comentarios', { musicaId : musica.id }) }}"
         data-source-arquivos="{{ path('api_attachments_from_praise', { id : musica.id, nome : musica.nome|lower|replace(' ', '_') }) }}"
         data-user="{{ app.usuario.roles }}"
         data-user-id="{{ app.usuario.id }}"
         data-dir-avatar="{{ app['dir.avatar'] }}"
         data-dir-anexos="{{ app['dir.anexo'] }}"
         data-musica-id="{{ musica.id }}"
         data-source-view="{{ path('musica_view', { id : musica.id, nome : musica.nome|lower|replace(' ', '_')  }) }}"
         data-source-editar="{{ path('view_editar_musica', { id : musica.id, nome : musica.nome|lower|replace(' ', '_') }) }}"
         data-source-add-letra="{{ path('view_editar_letra_musica', { id : musica.id }) }}"
         data-source-musica="{{ path('api_praise', { id : musica.id, nome : musica.nome|lower|replace(' ', '_') }) }}"
         data-source-musica-letra="{{ musica.letra }}"
         data-source-musica-tom="{{ musica.tom }}"
         data-source-videos="{{ path('videos') }}">
    </div>

    <script src="{{ asset(app['dir.base'] ~ 'assets/plugins/jQuery-Chord-Transposer/jquery.transposer.js') }}"></script>
    <script src="{{ asset(app['dir.base'] ~ 'assets/plugins/jQuery.filer/js/jquery.filer.min.js') }}"></script>
    <script src="{{ asset(app['dir.base'] ~ 'assets/blog/js/file-uploader.js') }}" type="text/javascript"></script>
    <script type="text/javascript" src="{{ asset(app['dir.base'] ~ 'assets/vendor/emojionearea/dist/emojionearea.js') }}" async></script>

    <script>
        $(document).on('shown.bs.tab', 'a[data-toggle="tab"]', function (e) {
            var tab = $(e.target);
            var contentId = tab.attr("href");
        });
    </script>
    <script type="text/javascript">
        $().ready(function () {
            // store the currently selected tab in the hash value
            $("ul.nav-tabs > li > a").click(function (e) {
                $(this).tab('show');
                history.pushState(null, null, $(e.target).attr("href"));
            });

            // on load of the page: switch to the currently selected tab
            $('ul.nav-tabs a[href="' + window.location.hash + '"]').tab('show');
        });
    </script>
    <script type="text/javascript">
        $(function(){
            var hash = window.location.hash;
            hash && $('ul.nav a[href="' + hash + '"]').tab('show');

            $('.nav-tabs a').click(function (e) {
                $(this).tab('show');
                var scrollmem = $('body').scrollTop() || $('html').scrollTop();
                window.location.hash = this.hash;
                $('html,body').scrollTop(scrollmem);
            });
        });
    </script>

{% endblock %}